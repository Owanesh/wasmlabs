# CryptoMock Server

A complete server that simulates the main endpoints and network calls made by cryptojacker scripts. This server allows you to test and analyze the behavior of cryptojacking malware in a controlled environment.

## Features

- **HTTPS Server** (port 8000) serving worker scripts and authentication endpoints
- **WebSocket Secure Server** (port 8008) for mining protocol simulation
- **Full protocol simulation** for cryptojacker communication
- **Detailed logging** of all requests and connections
- **Auto-generated SSL certificates** for testing
- **CORS support** for cross-origin requests

## Installation

1. **Install dependencies:**

    1.  Via [uv](https://docs.astral.sh/uv/getting-started/installation/)
    ```bash
    uv sync
    ```

    2. Via `requirements.txt`
    ```bash
    pip install -r requirements.txt
    ```


2. **Start the server:**
```bash
python server.py
```

The server will automatically create self-signed SSL certificates if they do not already exist.

## Supported Endpoints

### HTTPS Server (https://127.0.0.1:8000)

- `GET /` - Main endpoint
- `GET /lib/worker-asmjs.min.js` - Mining worker script
- `GET /captcha/` - Captcha endpoint (mock)
- `GET /media/miner.html` - Miner interface (mock)
- `POST /` - Generic POST endpoint
- `OPTIONS /` - CORS preflight


**Test Webserver**
```sh
curl -k https://localhost:8000
# CryptoMock Mock Server - HTTPS Endpoint%
```
### WebSocket Server (wss://127.0.0.1:8008/proxy)

- **Authentication**: Handles `auth` messages
- **Result submission**: Handles `submit` messages
- **Verification**: Handles `verified` messages
- **Job distribution**: Automatically sends new mining jobs

**Test websocket**
```sh
npx wscat -c wss://127.0.0.1:8008/ --no-check
```

## Simulated Mining Protocol

The server simulates a typical cryptojacker protocol:

1. **WebSocket connection** from the client
2. **Authentication** with a site_key
3. **Receive mining job**
4. **Client submits results**
5. **Server confirms acceptance**
6. **New job** is sent automatically


## Logging

The server generates detailed logs in:

- **Console**: Real-time output
- **File**: `cryptomock_server.log`

Logs include:
- HTTPS and WebSocket connections
- Received and sent messages
- Errors and warnings
- Mining statistics

## Configuration

Edit constants in `server.py` to change:

```python
HTTPS_HOST = "127.0.0.1"
HTTPS_PORT = 8000
WSS_HOST = "127.0.0.1"
WSS_PORT = 8008
```

## Malware Analysis

This server is useful for:

- **Static analysis**: Study malware behavior
- **Dynamic analysis**: Monitor network calls in real time
- **Research**: Understand cryptojacker protocols
- **Testing**: Validate detection solutions

## Security

⚠️ **WARNING**: This server is for research and testing purposes only. Do not use in production or with real data.

- SSL certificates are self-signed
- No real authentication
- Mining results are simulated
- Do not connect to real mining pools

## Troubleshooting

### SSL Error
If you have issues with SSL certificates:
```bash
# Remove existing certificates
rm https/cryptomock-server.crt https/cryptomock-server.key

# Restart the server to regenerate them
python server.py
```

### Port already in use
If ports are busy, change the constants in the code or kill the processes:
```bash
# Find processes using the ports
lsof -i :8000
lsof -i :8008

# Kill the processes
kill -9 <PID>
```

