#!/usr/bin/env python3
"""
Injects decimal representations into JavaScript files.

For each .txt file in the txt_dec/ directory, this script:
- Copies composed/base.js to js/<txt_filename>.js
- Replaces the label 'WASMIXER_DECIMAL_REPRESENTATION_OF_BINARY' in the copy
  with the content of the .txt file.

The original base.js is never modified.
"""

import os
import shutil
from typing import NoReturn

def main() -> NoReturn:
    label_to_replace: str = "WASMIXER_DECIMAL_REPRESENTATION_OF_BINARY"
    input_file: str = "placeholder/base_placeholder.js"
    text_dec_dir: str = "../composed/txt"
    output_dir: str = "../composed/js"

    # Ensure output directory exists
    os.makedirs(output_dir, exist_ok=True)

    # Process each .txt file in txt/
    for txt_file in os.listdir(text_dec_dir):
        if txt_file.endswith(".txt"):
            txt_path: str = os.path.join(text_dec_dir, txt_file)
            output_file: str = os.path.join(output_dir, f"{os.path.splitext(txt_file)[0]}.js")
            # Copy the original file to the output location
            shutil.copy2(input_file, output_file)
            # Read replacement text
            with open(txt_path, "r", encoding="utf-8") as tf:
                replacement_text: str = tf.read().strip()
            # Read the copied file, replace label, and write back
            with open(output_file, "r", encoding="utf-8") as outf:
                content: str = outf.read()
            new_content: str = content.replace(label_to_replace, replacement_text)
            with open(output_file, "w", encoding="utf-8") as outf:
                outf.write(new_content)
            print(f"Replaced label and wrote output to {output_file}")

if __name__ == "__main__":
    main()